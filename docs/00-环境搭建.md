# 环境搭建

## 学习目标

- 掌握Python环境的安装和配置
- 学会安装OpenCV库
- 配置合适的开发环境（推荐Jupyter Notebook）
- 验证环境是否配置成功

---

## 一、Python环境安装

### 1.1 检查是否已安装Python

打开命令行（Windows按Win+R输入cmd，Mac打开终端），输入：

```bash
python --version
```

或

```bash
python3 --version
```

如果显示版本号（如Python 3.8.x），说明已安装。如果提示"不是内部或外部命令"，则需要安装Python。

### 1.2 安装Python（如未安装）

**Windows系统：**
1. 访问 [Python官网](https://www.python.org/downloads/)
2. 下载最新版Python安装包（推荐3.9或3.10版本）
3. 运行安装程序，**重要：勾选"Add Python to PATH"**
4. 点击"Install Now"完成安装

**Mac系统：**
推荐使用Homebrew安装：
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew install python
```

### 1.3 验证Python安装

```bash
python --version
```

应显示类似：`Python 3.10.6`

---

## 二、安装OpenCV库

### 2.1 使用pip安装OpenCV

OpenCV的Python包名为opencv-python。在命令行输入：

```bash
pip install opencv-python
```

如果安装速度慢，可以使用国内镜像源：
```bash
pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2.2 安装numpy（OpenCV依赖）

OpenCV依赖numpy库进行数组运算：
```bash
pip install numpy
```

或一次性安装：
```bash
pip install opencv-python numpy
```

### 2.3 安装matplotlib（用于显示图像）

虽然OpenCV自带显示功能，但matplotlib更方便教学：
```bash
pip install matplotlib
```

### 2.4 完整安装命令

```bash
pip install opencv-python numpy matplotlib -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## 三、配置开发环境

### 3.1 推荐使用Jupyter Notebook

Jupyter Notebook非常适合学习和教学，可以分步执行代码并查看结果。

**安装Jupyter：**
```bash
pip install jupyter
```

**启动Jupyter：**
```bash
jupyter notebook
```

浏览器会自动打开Jupyter界面。

### 3.2 其他选择

**VS Code：**
- 下载安装 [VS Code](https://code.visualstudio.com/)
- 安装Python扩展
- 安装Jupyter扩展（支持.ipynb文件）

**PyCharm：**
- 下载安装 [PyCharm Community](https://www.jetbrains.com/pycharm/)

---

## 四、验证安装

### 4.1 创建测试文件

创建一个名为`test_opencv.py`的文件，输入以下代码：

```python
import cv2
import numpy as np

print("OpenCV版本:", cv2.__version__)
print("NumPy版本:", np.__version__)

# 创建一个简单的测试图像
test_image = np.zeros((300, 300, 3), dtype=np.uint8)
cv2.putText(test_image, "OpenCV Works!", (50, 150),
            cv2.FONT_HERSHEY_SIMPLEX, 1, (255, 255, 255), 2)

# 保存测试图像
cv2.imwrite("test_output.jpg", test_image)
print("测试图像已保存为 test_output.jpg")
```

### 4.2 运行测试

```bash
python test_opencv.py
```

如果看到类似以下输出，说明安装成功：
```
OpenCV版本: 4.8.0
NumPy版本: 1.24.3
测试图像已保存为 test_output.jpg
```

---

## 五、常见问题与解决方案

### Q1: pip命令不存在

**问题：** 提示"pip不是内部或外部命令"

**解决方案：**
1. 确保Python安装时勾选了"Add Python to PATH"
2. 使用完整路径：`python -m pip install opencv-python`
3. 或使用：`py -m pip install opencv-python`

### Q2: 安装失败或很慢

**问题：** pip安装超时或下载速度慢

**解决方案：**
```bash
# 使用国内镜像源
pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple

# 或永久配置镜像源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q3: 导入cv2失败

**问题：** `ImportError: No module named 'cv2'`

**解决方案：**
1. 确认安装成功：`pip list | grep opencv`
2. 重新安装：`pip uninstall opencv-python && pip install opencv-python`
3. 检查Python环境是否一致

### Q4: matplotlib显示中文乱码

**问题：** 图表中文字显示为方框

**解决方案：**
```python
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei']  # 用来正常显示中文标签
plt.rcParams['axes.unicode_minus'] = False  # 用来正常显示负号
```

### Q5: OpenCV显示窗口无法关闭

**问题：** `cv2.imshow()`窗口无响应

**解决方案：**
确保代码中有`cv2.waitKey(0)`和`cv2.destroyAllWindows()`：
```python
cv2.imshow('image', img)
cv2.waitKey(0)  # 等待按键
cv2.destroyAllWindows()  # 关闭窗口
```

---

## 六、第一个OpenCV程序

创建`hello_opencv.py`：

```python
import cv2
import numpy as np

# 1. 创建一个空白图像（蓝色背景）
image = np.zeros((400, 600, 3), dtype=np.uint8)
image[:] = (255, 0, 0)  # BGR格式：蓝色

# 2. 添加文字
cv2.putText(image, "Hello OpenCV!", (120, 200),
            cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 255, 255), 3)

# 3. 保存图像
cv2.imwrite("hello_opencv.jpg", image)
print("图像已保存！")

# 4. 显示图像
cv2.imshow("My First Image", image)
cv2.waitKey(3000)  # 显示3秒
cv2.destroyAllWindows()
```

运行程序：
```bash
python hello_opencv.py
```

---

## 七、课前准备检查清单

在培训开始前，请确保完成以下步骤：

- [ ] Python已安装（版本3.8+）
- [ ] OpenCV已安装（`import cv2`无报错）
- [ ] NumPy已安装
- [ ] Jupyter Notebook已安装并可以启动
- [ ] 能成功运行测试代码
- [ ] 了解如何打开和编辑Python文件

---

## 八、推荐IDE配置

### 使用Jupyter Notebook（推荐初学者）

```bash
# 启动Jupyter
jupyter notebook

# 在Jupyter中新建Notebook，测试：
import cv2
print(cv2.__version__)
```

### 使用VS Code

1. 安装插件：Python、Jupyter
2. 打开文件夹：`文件` → `打开文件夹`
3. 创建`.ipynb`文件进行练习

---

## 九、扩展阅读

- [OpenCV官方文档](https://docs.opencv.org/4.x/)
- [NumPy快速入门](https://numpy.org/doc/stable/user/quickstart.html)
- [Jupyter Notebook文档](https://jupyter-notebook.readthedocs.io/)

---

**下一步：** 完成[01-OpenCV简介与基础](./01-OpenCV简介与基础.md)
