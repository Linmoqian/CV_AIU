# OpenCVç®€ä»‹ä¸åŸºç¡€

## å­¦ä¹ ç›®æ ‡

- äº†è§£OpenCVæ˜¯ä»€ä¹ˆåŠå…¶åº”ç”¨åœºæ™¯
- æŒæ¡å›¾åƒçš„è¯»å–ã€æ˜¾ç¤ºå’Œä¿å­˜
- ç†è§£å›¾åƒçš„åŸºæœ¬å±æ€§ï¼ˆå°ºå¯¸ã€é€šé“æ•°ã€æ•°æ®ç±»å‹ï¼‰
- å­¦ä¼šåœ¨Pythonä¸­æ“ä½œOpenCV

---

## ä¸€ã€OpenCVç®€ä»‹

### 1.1 ä»€ä¹ˆæ˜¯OpenCVï¼Ÿ

**OpenCV**ï¼ˆOpen Source Computer Vision Libraryï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ åº“ï¼Œç”±Intelåœ¨1999å¹´å‘èµ·ï¼Œç°åœ¨ç”±Willow Garageå’ŒItseezå…¬å¸ç»´æŠ¤ã€‚

**ä¸»è¦ç‰¹ç‚¹ï¼š**
- è·¨å¹³å°ï¼šæ”¯æŒWindowsã€Linuxã€Mac OSã€Androidã€iOS
- è¯­è¨€æ”¯æŒï¼šC++ã€Pythonã€Javaç­‰
- åŠŸèƒ½å¼ºå¤§ï¼šåŒ…å«2500+ä¼˜åŒ–ç®—æ³•
- å…è´¹å¼€æºï¼šåŸºäºBSDè®¸å¯ï¼Œå¯å•†ç”¨
- æ€§èƒ½ä¼˜ç§€ï¼šåº•å±‚ç”¨C++ä¼˜åŒ–ï¼Œé€Ÿåº¦å¿«

### 1.2 OpenCVèƒ½åšä»€ä¹ˆï¼Ÿ

**åŸºç¡€å›¾åƒå¤„ç†ï¼š**
- å›¾åƒè¯»å–ã€æ˜¾ç¤ºã€ä¿å­˜
- å›¾åƒç¼©æ”¾ã€æ—‹è½¬ã€è£å‰ª
- è‰²å½©ç©ºé—´è½¬æ¢
- å›¾åƒæ»¤é•œï¼ˆæ¨¡ç³Šã€é”åŒ–ï¼‰

**è®¡ç®—æœºè§†è§‰ï¼š**
- è¾¹ç¼˜æ£€æµ‹ã€ç‰¹å¾æå–
- äººè„¸æ£€æµ‹ã€è¯†åˆ«
- ç‰©ä½“æ£€æµ‹ã€è¿½è¸ª
- å›¾åƒåˆ†å‰²

**é«˜çº§åº”ç”¨ï¼š**
- æœºå™¨äººè§†è§‰
- è‡ªåŠ¨é©¾é©¶
- åŒ»ç–—å›¾åƒåˆ†æ
- å¢å¼ºç°å®ï¼ˆARï¼‰
- è§†é¢‘åˆ†æ

### 1.3 OpenCVåœ¨æœºå™¨äººä¸­çš„åº”ç”¨

å¯¹äº**ç¿æŠ—æœºå™¨äººæ¯”èµ›**ï¼ŒOpenCVå¯ç”¨äºï¼š
- ğŸ¯ **å·¡çº¿**ï¼šè¯†åˆ«èµ›é“çº¿æ¡
- ğŸš— **é¿éšœ**ï¼šæ£€æµ‹éšœç¢ç‰©
- ğŸ€ **ç‰©ä½“è¯†åˆ«**ï¼šè¯†åˆ«çƒã€é—¨ç­‰ç›®æ ‡
- ğŸ¨ **é¢œè‰²è¯†åˆ«**ï¼šè¯†åˆ«ç‰¹å®šé¢œè‰²æ ‡è®°
- ğŸ“· **äºŒç»´ç è¯†åˆ«**ï¼šè¯»å–ä»»åŠ¡ä¿¡æ¯
- ğŸ¤– **è§†è§‰å®šä½**ï¼šç¡®å®šæœºå™¨äººä½ç½®

---

## äºŒã€å›¾åƒåŸºç¡€æ¦‚å¿µ

### 2.1 æ•°å­—å›¾åƒçš„è¡¨ç¤º

**æ•°å­—å›¾åƒ**æ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ ç§°ä¸º**åƒç´ ï¼ˆPixelï¼‰**ã€‚

**ç°åº¦å›¾åƒï¼š**
- å•é€šé“çŸ©é˜µï¼Œå€¼èŒƒå›´0-255
- 0=é»‘è‰²ï¼Œ255=ç™½è‰²

**å½©è‰²å›¾åƒï¼ˆBGRæ ¼å¼ï¼‰ï¼š**
- ä¸‰é€šé“çŸ©é˜µï¼ˆBlueã€Greenã€Redï¼‰
- æ¯ä¸ªé€šé“å€¼èŒƒå›´0-255
- OpenCVé»˜è®¤ä½¿ç”¨BGRè€ŒéRGB

**ç¤ºä¾‹ï¼š**
```
# ä¸€ä¸ª3x3çš„ç°åº¦å›¾ï¼ˆçŸ©é˜µè¡¨ç¤ºï¼‰
[[120, 125, 130],
 [115, 128, 135],
 [110, 122, 140]]

# ä¸€ä¸ª3x3çš„å½©è‰²å›¾ï¼ˆBGRæ ¼å¼ï¼‰
[[[255, 0, 0], [0, 255, 0], [0, 0, 255]],  # è“ã€ç»¿ã€çº¢
 [[255, 255, 0], [255, 0, 255], [0, 255, 255]],  # é’ã€æ´‹çº¢ã€é»„
 [[128, 128, 128], [200, 200, 200], [50, 50, 50]]]  # ä¸åŒç°åº¦
```

### 2.2 å›¾åƒçš„åŸºæœ¬å±æ€§

**é‡è¦å±æ€§ï¼š**
- **å½¢çŠ¶ï¼ˆshapeï¼‰**ï¼š`(height, width, channels)`
- **å°ºå¯¸ï¼ˆsizeï¼‰**ï¼š`height Ã— width Ã— channels`ï¼ˆæ€»åƒç´ æ•°ï¼‰
- **æ•°æ®ç±»å‹ï¼ˆdtypeï¼‰**ï¼šé€šå¸¸æ˜¯`uint8`ï¼ˆ0-255ï¼‰

**ç¤ºä¾‹ä»£ç ï¼š**
```python
import cv2
img = cv2.imread('image.jpg')
print(f"å›¾åƒå½¢çŠ¶: {img.shape}")  # (480, 640, 3)
print(f"å›¾åƒå°ºå¯¸: {img.size}")   # 921600
print(f"æ•°æ®ç±»å‹: {img.dtype}")  # uint8
```

---

## ä¸‰ã€å›¾åƒçš„è¯»å–ã€æ˜¾ç¤ºå’Œä¿å­˜

### 3.1 è¯»å–å›¾åƒ - `cv2.imread()`

**è¯­æ³•ï¼š**
```python
img = cv2.imread(filename, flags)
```

**å‚æ•°ï¼š**
- `filename`ï¼šå›¾ç‰‡è·¯å¾„ï¼ˆç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼‰
- `flags`ï¼šè¯»å–æ ‡å¿—
  - `cv2.IMREAD_COLOR`ï¼šåŠ è½½å½©è‰²å›¾ï¼ˆé»˜è®¤ï¼‰= 1
  - `cv2.IMREAD_GRAYSCALE`ï¼šåŠ è½½ç°åº¦å›¾ = 0
  - `cv2.IMREAD_UNCHANGED`ï¼šåŒ…å«é€æ˜é€šé“ = -1

**ç¤ºä¾‹ï¼š**
```python
import cv2

# æ–¹å¼1ï¼šè¯»å–å½©è‰²å›¾ï¼ˆé»˜è®¤ï¼‰
img1 = cv2.imread('photo.jpg')
img1 = cv2.imread('photo.jpg', cv2.IMREAD_COLOR)

# æ–¹å¼2ï¼šè¯»å–ç°åº¦å›¾
img2 = cv2.imread('photo.jpg', cv2.IMREAD_GRAYSCALE)
img2 = cv2.imread('photo.jpg', 0)

# æ–¹å¼3ï¼šè¯»å–åŒ…å«é€æ˜é€šé“
img3 = cv2.imread('photo.png', cv2.IMREAD_UNCHANGED)

# æ£€æŸ¥æ˜¯å¦æˆåŠŸ
if img is None:
    print("å›¾ç‰‡è¯»å–å¤±è´¥ï¼")
```

**âš ï¸ æ³¨æ„äº‹é¡¹ï¼š**
- è·¯å¾„ä¸­ä¸èƒ½æœ‰ä¸­æ–‡
- æ–‡ä»¶å¿…é¡»å­˜åœ¨
- è¯»å–å¤±è´¥è¿”å›`None`ï¼Œä¸ä¼šæŠ¥é”™

### 3.2 æ˜¾ç¤ºå›¾åƒ - `cv2.imshow()`

**è¯­æ³•ï¼š**
```python
cv2.imshow(window_name, image)
cv2.waitKey(delay)
cv2.destroyAllWindows()
```

**å‚æ•°ï¼š**
- `window_name`ï¼šçª—å£åç§°ï¼ˆå­—ç¬¦ä¸²ï¼‰
- `image`ï¼šè¦æ˜¾ç¤ºçš„å›¾åƒ
- `delay`ï¼šç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  - `0`ï¼šæ— é™ç­‰å¾…ï¼Œç›´åˆ°æŒ‰ä»»æ„é”®
  - `>0`ï¼šç­‰å¾…æŒ‡å®šæ¯«ç§’æ•°

**ç¤ºä¾‹ï¼š**
```python
import cv2

img = cv2.imread('photo.jpg')

# æ˜¾ç¤ºå›¾åƒ
cv2.imshow('My Photo', img)

# ç­‰å¾…æŒ‰é”®ï¼ˆ0è¡¨ç¤ºæ— é™ç­‰å¾…ï¼‰
cv2.waitKey(0)

# å…³é—­æ‰€æœ‰çª—å£
cv2.destroyAllWindows()
```

**åŒæ—¶æ˜¾ç¤ºå¤šå¼ å›¾ï¼š**
```python
img1 = cv2.imread('photo1.jpg')
img2 = cv2.imread('photo2.jpg')

cv2.imshow('Window 1', img1)
cv2.imshow('Window 2', img2)

cv2.waitKey(0)
cv2.destroyAllWindows()
```

**âš ï¸ é‡è¦ï¼š**
- å¿…é¡»é…åˆ`cv2.waitKey()`ä½¿ç”¨ï¼Œå¦åˆ™çª—å£æ— å“åº”
- æœ€åç”¨`cv2.destroyAllWindows()`å…³é—­æ‰€æœ‰çª—å£

### 3.3 ä¿å­˜å›¾åƒ - `cv2.imwrite()`

**è¯­æ³•ï¼š**
```python
cv2.imwrite(filename, image)
```

**å‚æ•°ï¼š**
- `filename`ï¼šä¿å­˜è·¯å¾„ï¼ˆæ”¯æŒ.jpg, .pngç­‰æ ¼å¼ï¼‰
- `image`ï¼šè¦ä¿å­˜çš„å›¾åƒ

**ç¤ºä¾‹ï¼š**
```python
import cv2

# è¯»å–å›¾åƒ
img = cv2.imread('input.jpg')

# å¤„ç†å›¾åƒï¼ˆä¾‹å¦‚è½¬ç°åº¦ï¼‰
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# ä¿å­˜å›¾åƒ
cv2.imwrite('output.jpg', gray)
cv2.imwrite('output.png', gray)  # PNGæ ¼å¼ï¼ˆæ— æŸï¼‰
print("å›¾åƒä¿å­˜æˆåŠŸï¼")
```

**æ”¯æŒçš„æ ¼å¼ï¼š**
- JPEG (.jpg, .jpeg)ï¼šæœ‰æŸå‹ç¼©ï¼Œæ–‡ä»¶å°
- PNG (.png)ï¼šæ— æŸå‹ç¼©ï¼Œæ”¯æŒé€æ˜é€šé“
- BMP (.bmp)ï¼šæ— å‹ç¼©ï¼Œæ–‡ä»¶å¤§

---

## å››ã€å®Œæ•´ç¤ºä¾‹ä»£ç 

### ç¤ºä¾‹1ï¼šè¯»å–ã€æ˜¾ç¤ºã€ä¿å­˜

```python
import cv2

# 1. è¯»å–å›¾åƒ
img = cv2.imread('../assets/sample-images/basic/landscape.jpg')

if img is None:
    print("æ— æ³•è¯»å–å›¾ç‰‡ï¼")
    exit()

# 2. æ˜¾ç¤ºå›¾åƒä¿¡æ¯
print(f"å›¾åƒå½¢çŠ¶: {img.shape}")
print(f"å›¾åƒå°ºå¯¸: {img.shape[1]}x{img.shape[0]}")
print(f"é€šé“æ•°: {img.shape[2]}")

# 3. æ˜¾ç¤ºå›¾åƒ
cv2.imshow('Original Image', img)
cv2.waitKey(3000)  # æ˜¾ç¤º3ç§’åè‡ªåŠ¨å…³é—­

# 4. ä¿å­˜å›¾åƒ
cv2.imwrite('output.jpg', img)
print("å›¾åƒå·²ä¿å­˜ä¸º output.jpg")

# 5. å…³é—­çª—å£
cv2.destroyAllWindows()
```

### ç¤ºä¾‹2ï¼šè¯»å–ä¸ºç°åº¦å›¾

```python
import cv2

# è¯»å–ç°åº¦å›¾
img_gray = cv2.imread('photo.jpg', cv2.IMREAD_GRAYSCALE)

# æˆ–ä»å½©è‰²å›¾è½¬æ¢
img_color = cv2.imread('photo.jpg')
img_gray2 = cv2.cvtColor(img_color, cv2.COLOR_BGR2GRAY)

# ä¿å­˜ç°åº¦å›¾
cv2.imwrite('gray_photo.jpg', img_gray)
```

### ç¤ºä¾‹3ï¼šå¯¹æ¯”å½©è‰²å›¾å’Œç°åº¦å›¾

```python
import cv2

img = cv2.imread('photo.jpg')
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# å¹¶æ’æ˜¾ç¤º
cv2.imshow('Color Image', img)
cv2.imshow('Grayscale Image', gray)

cv2.waitKey(0)
cv2.destroyAllWindows()
```

---

## äº”ã€ä½¿ç”¨matplotlibæ˜¾ç¤ºå›¾åƒ

é™¤äº†OpenCVè‡ªå¸¦çš„`imshow()`ï¼Œè¿˜å¯ä»¥ä½¿ç”¨matplotlibæ˜¾ç¤ºå›¾åƒï¼Œ**æ›´é€‚åˆæ•™å­¦å’Œè°ƒè¯•**ã€‚

```python
import cv2
import matplotlib.pyplot as plt

# è¯»å–å›¾åƒï¼ˆBGRæ ¼å¼ï¼‰
img = cv2.imread('photo.jpg')

# è½¬æ¢ä¸ºRGBæ ¼å¼ï¼ˆmatplotlibä½¿ç”¨RGBï¼‰
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# æ˜¾ç¤ºå›¾åƒ
plt.figure(figsize=(10, 5))

plt.subplot(1, 2, 1)
plt.imshow(img_rgb)
plt.title('RGB Image')
plt.axis('off')

plt.subplot(1, 2, 2)
plt.imshow(img_gray, cmap='gray')
plt.title('Grayscale Image')
plt.axis('off')

plt.tight_layout()
plt.show()
```

**âš ï¸ æ³¨æ„ï¼š**
- OpenCVä½¿ç”¨BGRæ ¼å¼
- matplotlibä½¿ç”¨RGBæ ¼å¼
- æ˜¾ç¤ºå‰éœ€è¦è½¬æ¢ï¼š`cv2.cvtColor(img, cv2.COLOR_BGR2RGB)`

---

## å…­ã€å¸¸è§é”™è¯¯

### é”™è¯¯1ï¼šè·¯å¾„é—®é¢˜

```python
# âŒ é”™è¯¯ï¼šè·¯å¾„ä¸­æœ‰ä¸­æ–‡
img = cv2.imread('å›¾ç‰‡/æµ‹è¯•.jpg')

# âœ… æ­£ç¡®ï¼šä½¿ç”¨è‹±æ–‡è·¯å¾„
img = cv2.imread('images/test.jpg')

# âœ… æ­£ç¡®ï¼šä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å¤„ç†Windowsè·¯å¾„
img = cv2.imread(r'D:\images\test.jpg')
```

### é”™è¯¯2ï¼šå¿˜è®°waitKey()

```python
# âŒ é”™è¯¯ï¼šçª—å£æ— å“åº”
cv2.imshow('image', img)
# ç¼ºå°‘ cv2.waitKey(0)
cv2.destroyAllWindows()

# âœ… æ­£ç¡®
cv2.imshow('image', img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

### é”™è¯¯3ï¼šé¢œè‰²é¡ºåºæ··ä¹±

```python
# âŒ é”™è¯¯ï¼šç›´æ¥ç”¨matplotlibæ˜¾ç¤ºOpenCVå›¾åƒï¼ˆé¢œè‰²ä¼šå˜ï¼‰
plt.imshow(img)  # BGRè¢«å½“ä½œRGBæ˜¾ç¤º

# âœ… æ­£ç¡®ï¼šå…ˆè½¬æ¢
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
plt.imshow(img_rgb)
```

---

## ä¸ƒã€ç»ƒä¹ é¢˜

### ç»ƒä¹ 1ï¼šåŸºç¡€æ“ä½œï¼ˆâ­ï¼‰
1. è¯»å–ä¸€å¼ å›¾ç‰‡
2. æ˜¾ç¤ºå›¾ç‰‡çš„å½¢çŠ¶å’Œå°ºå¯¸
3. ä¿å­˜ä¸ºç°åº¦å›¾
4. å¯¹æ¯”åŸå›¾å’Œç°åº¦å›¾

### ç»ƒä¹ 2ï¼šå¤šå›¾æ˜¾ç¤ºï¼ˆâ­â­ï¼‰
è¯»å–3å¼ ä¸åŒçš„å›¾ç‰‡ï¼Œå¹¶åœ¨3ä¸ªçª—å£ä¸­åŒæ—¶æ˜¾ç¤ºã€‚

### ç»ƒä¹ 3ï¼šå›¾åƒä¿¡æ¯ï¼ˆâ­ï¼‰
ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶å›¾ç‰‡è·¯å¾„ï¼Œè¾“å‡ºï¼š
- å›¾åƒå®½åº¦ã€é«˜åº¦
- é€šé“æ•°
- æ€»åƒç´ æ•°
- æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰

### ç»ƒä¹ 4ï¼šæ‰¹é‡è½¬æ¢ï¼ˆâ­â­ï¼‰
ç¼–å†™ç¨‹åºï¼Œå°†ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å½©è‰²å›¾ç‰‡è½¬æ¢ä¸ºç°åº¦å›¾å¹¶ä¿å­˜åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚

---

## å…«ã€æ‰©å±•æ€è€ƒ

1. **ä¸ºä»€ä¹ˆOpenCVä½¿ç”¨BGRè€Œä¸æ˜¯RGBï¼Ÿ**
   - æç¤ºï¼šå†å²åŸå› ï¼Œä¸æ—©æœŸæ‘„åƒæœºç¡¬ä»¶æœ‰å…³

2. **ç°åº¦å›¾å’Œå½©è‰²å›¾æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
   - å­˜å‚¨ï¼šå•é€šé“ vs ä¸‰é€šé“
   - ä¿¡æ¯é‡ï¼šä¸¢å¤±é¢œè‰²ä¿¡æ¯
   - åº”ç”¨ï¼šç°åº¦å›¾è®¡ç®—æ›´å¿«

3. **ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç°åº¦å›¾ï¼Ÿ**
   - è¾¹ç¼˜æ£€æµ‹
   - ç‰¹å¾æå–
   - å½¢çŠ¶è¯†åˆ«

---

**ä¸‹ä¸€æ­¥ï¼š** å­¦ä¹ [02-å›¾åƒåŸºæœ¬æ“ä½œ](./02-å›¾åƒåŸºæœ¬æ“ä½œ.md)
